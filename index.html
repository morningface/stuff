
<!DOCTYPE html>
<html>
<head>
	<title>It's Alex Time</title>
	<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0" />
	<script src="/stuff/assets/jquery-1.11.2.js"></script>
	<script src="/stuff/assets/modernizr-v3.0.0.min.js"></script>
	<link href='/stuff/assets/reset.css' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>
<body>

<div class="circle-loader"></div>
<div id="left-area">
		<div class="controls">
			<button id="play-all-button"></button>
			<button id="record-button"></button>
		</div>
		<div id="recordings"></div>
</div>
<div id="right-area">
	<div id="piano"><!--
		--><div class="controls"><!--
			--><div id="wave" class="control"><!--
				--><h3>Wave Form:</h3><!--
				--><div class="options">
					<input type="radio" name="wave" value="sine" id="sine" /><label for="sine">Sine</label>
					<input type="radio" name="wave" value="square" id="square" /><label for="square">Square</label>
					<input type="radio" name="wave" value="triangle" id="triangle" checked="checked" /><label for="triangle">Triangle</label>
					<input type="radio" name="wave" value="sawtooth" id="sawtooth" /><label for="sawtooth">Sawtooth</label>
				</div><!--
			--></div><!--
			--><div id="harmony" class="control"><!--
				--><h3>Harmony:</h3><!--
				--><div class="options">
					<input type="radio" name="harmony" value="" id="harmony-none" checked="checked" /><label for="harmony-none">None</label>
					<input type="radio" name="harmony" value="major" id="harmony-major" /><label for="harmony-major">Major</label>
					<input type="radio" name="harmony" value="minor" id="harmony-minor" /><label for="harmony-minor">Minor</label>
				</div><!--
			--></div><!--
			--><div id="arpeggio" class="control"><!--
				--><h3>Arpeggiation:</h3><!--
				--><div class="options">
					<input type="radio" name="arpeggio" value="" id="arpeggiation-none" checked="checked" /><label for="arpeggiation-none">None</label>
					<input type="radio" name="arpeggio" value="major" id="arpeggiation-major" /><label for="arpeggiation-major">Major</label>
					<input type="radio" name="arpeggio" value="minor" id="arpeggiation-minor" /><label for="arpeggiation-minor">Minor</label>
					<input type="radio" name="arpeggio" value="majorGradual" id="arpeggiation-major-gradual" /><label for="arpeggiation-major-gradual">Major Gradual</label>
					<input type="radio" name="arpeggio" value="minorGradual" id="arpeggiation-minor-gradual" /><label for="arpeggiation-minor-gradual">Minor Gradual</label>
					<label for="arpeggiation-number-octaves">Octaves: </label><select name="arpeggio-octaves" id="arpeggiation-number-octaves">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3" selected="selected">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
					</select>
				</div><!--
			--></div><!--
		--></div>
		<div class="keys"></div>
	</div>
	<div id="keyboard">
		<div class="row">
			<button class="key text-two-lines text-small" data-keynum="192">~<br />`</button>
			<button class="key text-two-lines text-small" data-keynum="49">!<br />1</button>
			<button class="key text-two-lines text-small" data-keynum="50">@<br />2</button>
			<button class="key text-two-lines text-small" data-keynum="51">#<br />3</button>
			<button class="key text-two-lines text-small" data-keynum="52">$<br />4</button>
			<button class="key text-two-lines text-small" data-keynum="53">%<br />5</button>
			<button class="key text-two-lines text-small" data-keynum="54">^<br />6</button>
			<button class="key text-two-lines text-small" data-keynum="55">&amp;<br />7</button>
			<button class="key text-two-lines text-small" data-keynum="56">*<br />8</button>
			<button class="key text-two-lines text-small" data-keynum="57">(<br />9</button>
			<button class="key text-two-lines text-small" data-keynum="48">)<br />0</button>
			<button class="key text-two-lines text-small" data-keynum="189">_<br />-</button>
			<button class="key text-two-lines text-small" data-keynum="187">+<br />=</button>
			<button class="key key--long text-small text-bottom text-right" data-keynum="8">delete</button>
		</div>
		<div class="row">
			<button class="key key--long text-bottom text-left text-small" data-keynum="9">tab</button>
			<button class="key" data-keynum="81">Q</button>
			<button class="key" data-keynum="87">W</button>
			<button class="key" data-keynum="69">E</button>
			<button class="key" data-keynum="82">R</button>
			<button class="key" data-keynum="84">T</button>
			<button class="key" data-keynum="89">Y</button>
			<button class="key" data-keynum="85">U</button>
			<button class="key" data-keynum="73">I</button>
			<button class="key" data-keynum="79">O</button>
			<button class="key" data-keynum="80">P</button>
			<button class="key text-two-lines text-small" data-keynum="219">{<br />[</button>
			<button class="key text-two-lines text-small" data-keynum="221">}<br />]</button>
			<button class="key text-two-lines text-small" data-keynum="220">|<br />\</button>
		</div>
		<div class="row">
			<button class="key key--longer text-bottom text-left text-small" data-keynum="20">caps lock</button>
			<button class="key" data-keynum="65">A</button>
			<button class="key" data-keynum="83">S</button>
			<button class="key" data-keynum="68">D</button>
			<button class="key" data-keynum="70">F</button>
			<button class="key" data-keynum="71">G</button>
			<button class="key" data-keynum="72">H</button>
			<button class="key" data-keynum="74">J</button>
			<button class="key" data-keynum="75">K</button>
			<button class="key" data-keynum="76">L</button>
			<button class="key text-two-lines text-small" data-keynum="186">:<br />;</button>
			<button class="key text-two-lines text-small" data-keynum="222">"<br />'</button>
			<button class="key key--longer text-right text-two-lines text-small" data-keynum="13">
				<span class="text-smaller">enter</span>
				<br />return
			</button>
		</div>
		<div class="row">
			<button class="key key--longest text-bottom text-left text-small">shift</button>
			<button class="key" data-keynum="90">Z</button>
			<button class="key" data-keynum="88">X</button>
			<button class="key" data-keynum="67">C</button>
			<button class="key" data-keynum="86">V</button>
			<button class="key" data-keynum="66">B</button>
			<button class="key" data-keynum="78">N</button>
			<button class="key" data-keynum="77">M</button>
			<button class="key text-two-lines text-small" data-keynum="188"><<br />,</button>
			<button class="key text-two-lines text-small" data-keynum="190">><br />.</button>
			<button class="key text-two-lines text-small" data-keynum="191">?<br />/</button>
			<button class="key key--longest text-bottom text-right text-small" data-keynum="16">shift</button>
		</div>
		<div class="row">
			<button class="key text-bottom text-small text-left">fn</button>
			<button class="key text-bottom text-small text-left">control</button>
			<button class="key text-small text-left text-two-lines">
				<span class="text-smaller">alt</span>
				<br />option
			</button>
			<button class="key key--thick text-small text-right text-two-lines">
				<span class="text-smaller">&#8984;</span>
				<br />command
			</button>
			<button class="key key--space"></button>
			<button class="key key--thick text-small text-left text-two-lines">
				<span class="text-smaller">&#8984;</span>
				<br />command
			</button>
			<button class="key text-small text-right text-two-lines">
				<span class="text-smaller">alt</span>
				<br />option
			</button>
			<button class="key key--arrow key--arrow--up text-smaller">&#9650;</button>
			<button class="key key--arrow text-smaller">&#9664;</button>
			<button class="key key--arrow key--arrow--down text-smaller">&#9660;</button>
			<button class="key key--arrow text-smaller">&#9654;</button>
		</div>
	</div>
</div>

<script>
	
	(function () {
		'use strict';
		
		// page load
		$(function () {
			
			window.piano;
			
			if (window.AudioContext || window.webkitAudioContext) {
				window.piano = new Piano();
				window.piano.init();
			} else {
				$('.keys').append("<h2>Sorry, your browser doesn't support awesome things :(</h2>");
				return;
			}
			
			setTimeout(function() {
				$('.circle-loader').addClass('circle-loader--loaded');
			}, 500);
		});
		
		var Piano = function() {
			
			// holds each note's frequency, oscillators, and gain nodes
			this.notes = {};
			
			// max gain value
			this.maxVolume = 0.5;
			
			// currently selected waveform
			this.currentWaveForm = 'triangle';
			
			// arpeggiation name, number of octaves, chord progression
			this.arpeggiationName = '';
			this.arpeggiationOctaves = 3;
			this.arpeggiationProgression = [];
			
			// harmony
			this.harmony = '';
			
			// keycodes mapped to their note numbers
			this.keyCodes = {
				9:		52, // tab
				49:		53, // 1
				81:		54, // q
				50:		55, // 2
				87:		56, // w
				69:		57, // e
				52:		58, // 4
				82:		59, // r
				53:		60, // 5
				84:		61, // t
				54:		62, // 6
				89:		63, // y
				85:		64, // u
				56:		65, // 8
				73:		66, // i
				57:		67, // 9
				79:		68, // o
				80:		69, // p
				189:	70, // -
				219:	71, // [
				187:	72, // =
				221:	73, // ]
				8:		74, // backspace
				220:	75, // backslash
				16:		51, // shift
				222:	50, // '
				191:	49, // /
				186:	48, // ;
				190:	47, // .
				76:		46, // l
				188:	45, // ,
				77:		44, // m
				74:		43, // j
				78:		42, // n
				72:		41, // h
				66:		40, // b
				86:		39, // v
				70:		38, // f
				67:		37, // c
				68:		36, // d
				88:		35, // x
				83:		34, // s
				90:		33, // z
				65:		32, // a
			};
			
			// chord progressions
			this.chordProgressions = {
				'major': [4, 7, 12],
				'minor': [3, 7, 12],
				'majorGradual': [4, 0, 4, 7, 4, 7, 12, 7, 12],
				'minorGradual': [3, 0, 3, 7, 3, 7, 12, 7, 12],
			};
			
			// array of recordings and current recording
			this.recordings = [];
			this.currentRecording;
			
			// appends notes, populates note data
			this.init = function() {
				this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				
				for (var i=1; i<89; i++) {
					var black_class = ($.inArray(i%12, [0,2,5,7,10]) > -1) ? ' black' : '';
					$('#piano .keys').append('<div class="key' + black_class + '" data-note="' + i + '"></div>');
					this.notes[i] = {
						freq: this.getFrequency(i),
						o: null,
						g: null,
						childNotes: []
					};
				}
				
				for (var key in this.keyCodes) {
					$('[data-keynum=' + key + ']').attr('data-note', this.keyCodes[key]);
				}
				
				this.listen();
			};
			
			// attaches event handlers
			this.listen = function() {
				var that = this;
				
				if ($('html.no-touchevents').length) {
					var mousedown = false;
					
					$(window).keydown(function(e) {
						if (that.keyCodes[e.keyCode] != undefined && that.keyCodes[e.keyCode] != null) {
							e.preventDefault();
							that.pressNote(that.keyCodes[e.keyCode]);
						}
					});

					$(window).keyup(function(e) {
						that.releaseNote(that.keyCodes[e.keyCode]);
					});

					$('.key').mousedown(function(e) {
						mousedown = true;
						that.pressNote(parseInt($(this).data('note')));
					}).mouseup(function(e) {
						mousedown = false;
						that.releaseNote(parseInt($(this).data('note')));
					}).hover(function(e) {
						if (mousedown) {
							that.pressNote(parseInt($(this).data('note')));
						}
					}, function(e) {
						that.releaseNote(parseInt($(this).data('note')));
					});

					$(window).on('mouseup', function(e) {
						mousedown = false;
					}).on('blur', function(e) {
						mousedown = false;
						that.releaseAllNotes();
					});
				} else {
					var touchdown = false;

					$('.key').on('touchstart', function(e) {
						touchdown = true;
						that.pressNote(parseInt($(this).data('note')));
					}).on('touchend', function(e) {
						touchdown = false;
						that.releaseAllNotes();
					});
				}
				
				$('.controls [name=wave]').click(function(e) {
					that.setWaveForm($(this).filter(':checked').val());
				});
				
				$('.controls [name=arpeggio]').change(function(e) {
					that.setArpeggiation($(this).filter(':checked').val());
				});
				
				$('.controls [name=arpeggio-octaves]').change(function(e) {
					that.setArpeggiationOctaves(parseInt($(this).val()));
				});
				
				$('.controls [name=harmony]').change(function(e) {
					that.setHarmony($(this).filter(':checked').val());
				});
				
				$('#record-button').click(function(e) {
					$(this).toggleClass('pressed');
					that.toggleRecording();
				});
				
				$('#play-all-button').click(function(e) {
					that.playAllRecordings();
				});
			}
			
			// creates oscillator/gain with keynumber's frequency
			// visually presses note on page
			this.pressNote = function(keynum, internal) {
				if (keynum != undefined
					&& keynum != null
					&& this.notes[keynum]) {
					if (!this.notes[keynum].o) {
						var gainNode = this.audioCtx.createGain();
						gainNode.connect(this.audioCtx.destination);
						gainNode.gain.value = 0;

						var oscillator = this.audioCtx.createOscillator();
						oscillator.type = this.currentWaveForm;
						oscillator.frequency.value = this.notes[keynum].freq;
						oscillator.connect(gainNode);
						oscillator.start(this.audioCtx.currentTime);

						var now = this.audioCtx.currentTime;
						gainNode.gain.cancelScheduledValues(now);
						gainNode.gain.setValueAtTime(0, now);
						gainNode.gain.linearRampToValueAtTime(this.maxVolume, now + 0.01);

						this.notes[keynum].o = oscillator;
						this.notes[keynum].g = gainNode;

						$('[data-note=' + keynum + ']').addClass('pressed');

						if (!internal) {
							this.arpeggiate(keynum);
							this.harmonize(keynum);
						}
						
						if (this.currentRecording) {
							this.currentRecording.pressNote(keynum, internal);
						}
					} else if (!internal) {
						this.harmonize(keynum);
					}
				}
			}
			
			// ramps down note's gain, destroys gain and oscillator
			// visually releases note on page
			this.releaseNote = function(keynum) {
				if (keynum != undefined
						&& keynum != null
						&& this.notes[keynum] != null
						&& this.notes[keynum].o != null
				   ) {
					
					var now = this.audioCtx.currentTime;
					var note = this.notes[keynum];
					note.g.gain.cancelScheduledValues(now);
					note.g.gain.setValueAtTime(this.notes[keynum].g.gain.value, now);
					note.g.gain.exponentialRampToValueAtTime(0.0001, now + 1);
					note.g = null;
					
					note.o.stop(now + 1);
					note.o = null;
					
					for (var i=0; i<note.childNotes.length; i++) {
						this.releaseNote(note.childNotes[i]);
					}
					
					$('[data-note=' + keynum + ']').removeClass('pressed');
				}
						
				if (this.currentRecording) {
					this.currentRecording.releaseNote(keynum);
				}
			};
			
			// calls releaseNote() on all key numbers
			this.releaseAllNotes = function() {
				var now = this.audioCtx.currentTime;
				
				for (var note in this.notes) {
					this.releaseNote(note);
				}
			};
			
			// trigger note creation for harmony
			this.harmonize = function(keynum) {
				var harmony;
				if (this.chordProgressions[this.harmony]) {
					harmony = this.chordProgressions[this.harmony];
				} else {
					return;
				}
				
				for (var i=0; i<harmony.length; i++) {
					this.pressNote(keynum + harmony[i], true);
					this.notes[keynum].childNotes.push(keynum + harmony[i]);
				}
			};
			
			// trigger note creation for arpeggio harmony
			this.arpeggiate = function(keynum) {
				
				var i=0, that = this;
				this.calculateArpeggiation();
				
				var interval = setInterval(function() {	
					if (that.notes[keynum].o) {
						that.createSelfDecayingNote(that.arpeggiationProgression[i] + keynum);
						i = i >= that.arpeggiationProgression.length - 1 ? 0 : i+1;
					} else {
						clearInterval(interval);
					}
				}, 100);
			};
			
			// update chord progression to use for arpeggiation
			this.calculateArpeggiation = function() {
				var progression = this.chordProgressions[this.arpeggiationName] || [];
				var arpeggio = [];
				
				for (var octave=0; octave<this.arpeggiationOctaves; octave++) {
					for (var j=0; j<progression.length; j++) {
						arpeggio.push(progression[j] + (octave * 12));
					}
				}
				
				// add the inverse of the array back into it
				// excludes first and last notes to avoid repetition during arpeggiation
				for (var j=arpeggio.length-2; j>0; j--) {
					arpeggio.push(arpeggio[j]);
				}

				this.arpeggiationProgression = arpeggio;
			};
			
			// creates self contained note that ends itself after 100ms
			this.createSelfDecayingNote = function(keynum) {
				if (keynum != undefined
						&& keynum != null
						&& this.notes[keynum]) {

					var gainNode = this.audioCtx.createGain();
					gainNode.connect(this.audioCtx.destination);
					gainNode.gain.value = 0;

					var oscillator = this.audioCtx.createOscillator();
					oscillator.type = this.currentWaveForm;
					oscillator.frequency.value = this.notes[keynum].freq;
					oscillator.connect(gainNode);
					oscillator.start(this.audioCtx.currentTime);

					var now = this.audioCtx.currentTime;
					gainNode.gain.cancelScheduledValues(now);
					gainNode.gain.setValueAtTime(0, now);
					gainNode.gain.linearRampToValueAtTime(this.maxVolume, now + 0.01);

					var that = this;
					setTimeout(function() {
						var now = that.audioCtx.currentTime;
						gainNode.gain.cancelScheduledValues(now);
						gainNode.gain.setValueAtTime(gainNode.gain.value, now);
						gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 1);
						gainNode = null;

						oscillator.stop(now + 1);
						oscillator = null;
					}, 100);
				}
						
				if (this.currentRecording) {
					this.currentRecording.createSelfDecayingNote(keynum);
				}
			};
			
			// returns frequency for given piano key number
			this.getFrequency = function(keynum) {
				return Math.pow(Math.pow(2,1/12),keynum-49)*440;
			};
			
			// updates the current waveform used when creating oscillators
			this.setWaveForm = function(form) {
				if (form == 'square'
				   		|| form == 'triangle'
				   		|| form == 'sawtooth') {
					this.currentWaveForm = form;
					return;
				}
				
				this.currentWaveForm = 'sine';
			};
			
			// updates the current arpeggiation type
			this.setArpeggiation = function(state) {
				this.arpeggiationName = state;
				this.calculateArpeggiation();
			};
			
			// updates the current arpeggiation octaves
			this.setArpeggiationOctaves = function(qty) {
				if (!(qty >= 1 && qty <= 5))
					qty = 3;
				
				this.arpeggiationOctaves = qty;
				this.calculateArpeggiation();
			};
			
			// updates the current harmony type
			this.setHarmony = function(state) {
				this.harmony = state;
			};
			
			// either initialize a recording or stop and save a recording
			this.toggleRecording = function() {
				if (!this.currentRecording) {
					this.currentRecording = new Recording(this);
				} else {
					this.currentRecording.save();
					this.recordings.push(this.currentRecording);
					this.currentRecording = null;
				}
			};
			
			// call play() on all known recordings
			this.playAllRecordings = function() {
				for (var i=0; i < this.recordings.length; i++) {
					this.recordings[i].play();
				}
			};
			
			// set all controls to initial settings
			this.resetControls = function() {
				
				$('#arpeggiation-none').prop('checked', true);
				
				$('#harmony-none').prop('checked', true);
			}
		};
		
		var Recording = function(source) {
			
			this.instrument = source;
			this.record = [];
			this.startTime = (new Date()).getTime();
			this.duration;
			this.domElement;
			
			this.pressNote = function(keynum, internal) {
				var that = this, relativeTime = (new Date()).getTime() - this.startTime;
				this.record.push(function() {
					setTimeout(function() {
						that.instrument.pressNote(keynum, internal);
					}, relativeTime);
				});
			};
			
			this.createSelfDecayingNote = function(keynum) {
				var that = this, relativeTime = (new Date()).getTime() - this.startTime;
				this.record.push(function() {
					setTimeout(function() {
						that.instrument.createSelfDecayingNote(keynum);
					}, relativeTime);
				});
			};
			
			this.releaseNote = function(keynum) {
				var that = this, relativeTime = (new Date()).getTime() - this.startTime;
				this.record.push(function() {
					setTimeout(function() {
						that.instrument.releaseNote(keynum);
					}, relativeTime);
				});
			};
			
			this.save = function() {
				this.duration = (new Date()).getTime() - this.startTime;
				this.appendToPage();
			}
			
			this.appendToPage = function() {
				var $dom = $('<div class="recording"></div>');
				$dom.append('<h3>Recording</h3><p>Length: ' + (this.duration / 1000) + ' seconds</p>');
				$dom.appendTo('#recordings');
				
				var $button = $('<button></button>');
				$button.appendTo($dom);
				
				this.domElement = $dom;
				
				var that = this;
				$button.click(function() {
					that.play();
				});
			}
			
			this.play = function() {
				this.domElement.addClass('playing');
				
				this.instrument.resetControls();
				
				for (var i=0; i<this.record.length; i++) {
					this.record[i]();
				}
				
				this.instrument.releaseAllNotes();
				
				var that = this;
				setTimeout(function() {
					that.domElement.removeClass('playing');
				}, this.duration);
			};
		};
	}());
	
</script>

<style>
	body {
		margin: 0;
		font-family: Lato;
	}
	
	#right-area {
		width: 80%;
		background: rgba(51,180,255,1);
		background: -moz-linear-gradient(left, rgba(51,180,255,1) 0%, rgba(0,152,240,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(51,180,255,1)), color-stop(100%, rgba(0,152,240,1)));
		background: -webkit-linear-gradient(left, rgba(51,180,255,1) 0%, rgba(0,152,240,1) 100%);
		background: -o-linear-gradient(left, rgba(51,180,255,1) 0%, rgba(0,152,240,1) 100%);
		background: -ms-linear-gradient(left, rgba(51,180,255,1) 0%, rgba(0,152,240,1) 100%);
		background: linear-gradient(to right, rgba(51,180,255,1) 0%, rgba(0,152,240,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#33b4ff', endColorstr='#0098f0', GradientType=1 );
		min-height: 100vh;
		padding-bottom: 375px;
		box-sizing: border-box;
		position: relative;
		margin-left: 20%;
	}
	
	#left-area {
		position: fixed;
		left: 0;
		top: 0;
		width: 20%;
		box-sizing: border-box;
		bottom: 0;
		z-index: 1;
		background: rgba(136,136,136,1);
		background: -moz-linear-gradient(left, rgba(136,136,136,1) 0%, rgba(119,119,119,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(136,136,136,1)), color-stop(100%, rgba(119,119,119,1)));
		background: -webkit-linear-gradient(left, rgba(136,136,136,1) 0%, rgba(119,119,119,1) 100%);
		background: -o-linear-gradient(left, rgba(136,136,136,1) 0%, rgba(119,119,119,1) 100%);
		background: -ms-linear-gradient(left, rgba(136,136,136,1) 0%, rgba(119,119,119,1) 100%);
		background: linear-gradient(to right, rgba(136,136,136,1) 0%, rgba(119,119,119,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#888888', endColorstr='#777777', GradientType=1 );
		box-shadow: -10px 0px 10px -10px #000 inset;
	}
	
	.circle-loader {
		position: fixed;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		z-index: -1;
		background-color: rgb(255,255,255);
		opacity: 0.1;
		border-radius: 50%;
		width: 0vw;
		height: 0vw;
		margin: auto;
		-webkit-transition: width ease-in-out 0.5s, height ease-in-out 0.5s, opacity ease-in-out 0.5s, background-color ease-in-out 0.5s;
	}
	
	.circle-loader--loaded {
		width: 70vw;
		height: 70vw;
		background-color: rgb(255,255,255);
		opacity: 0;
	}
	
	#piano {
		padding-bottom: 5px;
		background-color: #ddd;
		box-shadow: 0px 0px 10px -3px #000;
		border-bottom: solid 1px #222;
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		overflow: hidden;
	}
	
	#piano .keys {
		text-align: center;
		position: relative;
	}
	
	#piano .key {
		width: 2%;
		height: 12vw;
		background-color: #fff;
		display: inline-block;
		cursor: pointer;
		margin-right: 1px;
		vertical-align: top;
		box-sizing: border-box;
		border: solid 1px #aaa;
		border-top: none;
		margin-right: -1px;
		position: relative;
		box-shadow: 3px 3px 15px -8px #000;
	}
	
	#piano .key.black {
		background-color: #000;
		border-color: #ddd;
		margin-left: -0.75%;
		height: 7vw;
		z-index: 2;
		width: 1.5%;
		box-shadow: 3px 3px 10px -3px #000;
	}
	
	#piano .key.pressed {
		background: rgba(255,62,62,1);
		background: -moz-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(255,62,62,1)), color-stop(100%, rgba(204,57,57,1)));
		background: -webkit-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -o-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -ms-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: linear-gradient(to right, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ff3e3e', endColorstr='#cc3939', GradientType=1 );
	}
	
	#piano .key.black + .key:not(.black) {
		margin-left: -0.75vw;
	}
	
	#piano .controls {
		text-align: center;
		background: rgba(221,221,221,1);
		background: -moz-linear-gradient(left, rgba(221,221,221,1) 0%, rgba(187,187,187,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(221,221,221,1)), color-stop(100%, rgba(187,187,187,1)));
		background: -webkit-linear-gradient(left, rgba(221,221,221,1) 0%, rgba(187,187,187,1) 100%);
		background: -o-linear-gradient(left, rgba(221,221,221,1) 0%, rgba(187,187,187,1) 100%);
		background: -ms-linear-gradient(left, rgba(221,221,221,1) 0%, rgba(187,187,187,1) 100%);
		background: linear-gradient(to right, rgba(221,221,221,1) 0%, rgba(187,187,187,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#dddddd', endColorstr='#bbbbbb', GradientType=1 );
		box-shadow: 0px 0px 10px 0px #000;
		z-index: 1;
		position: relative;
	}
	
	.controls .control {
	    display: inline-block;
		margin: 10px 30px;
		vertical-align: middle;
		text-align: center;
	}
	
	.controls .control h3 {
		display: inline-block;
		line-height: 30px;
		margin: 5px;
		vertical-align: middle;
		font-size: 18px;
	}
	
	.controls .control .options {
		display: inline-block;
		vertical-align: middle;
	}
	
	input[type=radio] {
		display: none;
	}
	
	input[type=radio] + label {
		margin: 5px;
		display: inline-block;
		cursor: pointer;
		min-width: 45px;
		height: 30px;
		line-height: 30px;
		background-position: center center;
		background-size: contain;
		border-radius: 3px;
		padding-left: 5px;
		padding-right: 5px;
		background-color: #eee;
		border: solid 2px #222;
		font-size: 14px;
	}
	
	input[type=radio]:checked + label {
		box-shadow: 0px 0px 9px 0px #33b4ff;
		background-color: rgba(51,180,255,1);
		cursor: default;
	}
	
	#wave input + label {
		font-size: 0;
	}
	
	#sine + label {background-image: url(/stuff/assets/sine_wave.png);}
	#square + label {background-image: url(/stuff/assets/square_wave.png);}
	#triangle + label {background-image: url(/stuff/assets/triangular_wave.png);}
	#sawtooth + label {background-image: url(/stuff/assets/sawtooth_wave.png);}
	
	#keyboard {
		max-width: 1000px;
		margin-left: auto;
		margin-right: auto;
		margin-top: 50px;
		padding-left: 1.8%;
		padding-right: 1%;
		padding-top: 1%;
		padding-bottom: 1%;
		background-color: #fff;
		box-shadow: 0 0 10px 0 #000 inset;
		background: rgba(255,255,255,1);
		background: -moz-linear-gradient(left, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(255,255,255,1)), color-stop(47%, rgba(246,246,246,1)), color-stop(100%, rgba(237,237,237,1)));
		background: -webkit-linear-gradient(left, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
		background: -o-linear-gradient(left, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
		background: -ms-linear-gradient(left, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
		background: linear-gradient(to right, rgba(255,255,255,1) 0%, rgba(246,246,246,1) 47%, rgba(237,237,237,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#ededed', GradientType=1 );
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
	}
	
	#keyboard .row {
		width: 100%;
		display: table;
	}
	
	#keyboard .key {
		width: 6%;
		border: none;
		height: 55px;
		margin-right: 0.8%;
		margin-top: 0.4%;
		margin-bottom: 0.4%;
		text-align: center;
		background-color: #222;
		color: #fff;
		font-size: 20px;
		border-radius: 4px;
		float: left;
		overflow: hidden;
		padding: 5px 10px;
    	box-shadow: 1px 1px 3px -2px #000;
	}
	
	@media ( max-width: 767px ) {
		#keyboard .key {
			padding-left: 0;
			padding-right: 0;
		}
	}
	
	#keyboard .key.key--thick {
		width: 8.3%;
	}
	
	#keyboard .key.key--long {
		width: 10.8%;
	}
	
	#keyboard .key.key--longer {
		width: 11.8%;
	}
	
	#keyboard .key.key--longest {
		width: 15.2%;
	}
	
	#keyboard .key.key--space {
		width: 33.3%;
	}
	
	#keyboard .key.key--arrow {
		height: 27px;
		margin-top: 0;
	}
	
	#keyboard .key.key--arrow.key--arrow--up {
		margin-top: 0.4%;
		margin-left: 6.8%;
		margin-right: 6.8%;
		margin-bottom: 0;
		border-bottom-left-radius: 0;
		border-bottom-right-radius: 0;
	}
	
	#keyboard .key.key--arrow.key--arrow--down {
		border-top-left-radius: 0;
		border-top-right-radius: 0;
	}
	
	#keyboard .key:not([data-note]) {
		background-color: #ddd;
	}
	
	#keyboard .text-small {
		font-size: 14px;
	}
	
	#keyboard .text-smaller {
		font-size: 12px;
	}
	
	#keyboard .text-bottom {
		line-height: 65px;
	}
	
	#keyboard .text-left {
		text-align: left;
	}
	
	#keyboard .text-right {
		text-align: right;
	}
	
	#keyboard .text-two-lines {
    	line-height: 20px;
	}
	
	#keyboard .key.pressed {
		background: rgba(255,62,62,1);
		background: -moz-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(255,62,62,1)), color-stop(100%, rgba(204,57,57,1)));
		background: -webkit-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -o-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: -ms-linear-gradient(left, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		background: linear-gradient(to right, rgba(255,62,62,1) 0%, rgba(204,57,57,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ff3e3e', endColorstr='#cc3939', GradientType=1 );
	}
	
	#recordings {
		padding-top: 128px;
		overflow: scroll;
		height: 100vh;
		box-sizing: border-box;
	}
	
	#left-area .controls {
		height: 128px;
		text-align: center;
		box-sizing: border-box;
		position: absolute;
		background: rgba(221,221,221,1);
		background: -moz-linear-gradient(left, rgba(204,204,204,1) 0%, rgba(221,221,221,1) 100%);
		background: -webkit-gradient(left top, right top, color-stop(0%, rgba(204,204,204,1)), color-stop(100%, rgba(221,221,221,1)));
		background: -webkit-linear-gradient(left, rgba(204,204,204,1) 0%, rgba(221,221,221,1) 100%);
		background: -o-linear-gradient(left, rgba(204,204,204,1) 0%, rgba(221,221,221,1) 100%);
		background: -ms-linear-gradient(left, rgba(204,204,204,1) 0%, rgba(221,221,221,1) 100%);
		background: linear-gradient(to right, rgba(204,204,204,1) 0%, rgba(221,221,221,1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#cccccc', endColorstr='#dddddd', GradientType=1 );
		box-shadow: 0px 0px 10px 0px #000;
		top: 0;
		left: 0;
		right: 0;
		z-index: 1;
	}
	
	#record-button {
		height: 73px;
		width: 150px;
		max-width: 100%;
		margin: 28px auto 0;
		border-radius: 3px;
		background-color: #eee;
		box-shadow: 0 0 20px -7px #000;
		border: solid 2px #222;
		font-size: 20px;
		display: inline-block;
		cursor: pointer;
		outline: none !important;
	}
	
	#record-button:before {
		content: 'Start Recording';
	}
	
	#record-button.pressed {
		background-color: #ff1234;
		box-shadow: 0 0 30px 0px #ff1234;
		color: #fff;
	}
	
	#record-button.pressed:before {
		content: 'Stop Recording';
	}
	
	#play-all-button {
		height: 73px;
		width: 73px;
		max-width: 100%;
		margin: 28px auto 0;
		border-radius: 3px;
		background-color: #eee;
		box-shadow: 0 0 20px -7px #000;
		border: solid 2px #222;
		font-size: 20px;
		display: inline-block;
		cursor: pointer;
		outline: none !important;
	}
	
	#play-all-button:before {
		content: 'Play All';
	}
	
	#recordings .recording {
		text-align: left;
		padding: 10px;
		border-bottom: solid 1px #444;
		color: #fff;
		position: relative;
		padding-left: 70px;
		min-height: 50px;
	}
	
	#recordings .recording button {
		position: absolute;
		left: 10px;
		width: 50px;
		height: 50px;
		top: 10px;
		background-color: #eee;
		box-shadow: 0 0 20px -7px #000;
		border: solid 2px #222;
		font-size: 14px;
		cursor: pointer;
		border-radius: 3px;
		outline: none !important;
	}
	
	#recordings .recording button:before {
		content: 'Play';
	}
	
	#recordings .recording.playing button {
		background-color: #ff1234;
		box-shadow: 0 0 30px 0px #ff1234;
		color: #fff;
	}
	
	#recordings .recording.playing button:before {
		content: '---';
	}
	
</style>

</body>
</html>
